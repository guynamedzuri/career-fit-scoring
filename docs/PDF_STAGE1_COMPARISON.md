# PDF 1단계(pdftotext) 출력물 비교 요약

20건 1단계 raw 출력(`*.stage1_raw.txt`)을 비교한 결과, 아래와 같은 **구조적 차이**와 **정규식 파싱 리스크**가 있습니다.

---

## 1. 1단계 출력물 간 큰 차이

### 1.1 성별·생년·나이 줄 형식

| 형식 | 예시 | 해당 파일 |
|------|------|-----------|
| `남, YYYY (N세)` / `여, YYYY (N세)` | 남, 1991 (34세) | 대부분(강동화, 고재영, …) |
| `YYYY (N세)` 만 있음 | 1998 (27세), 1987 (38세) | **홍순철**, **PRASETYO** |

- **영향**: `(남|여)\s*,\s*(\d{4})\s*\((\d+)세\)` 에만 의존하면 홍순철·PRASETYO에서 age/birthYear 누락.
- **대응**: 이미 `YYYY (N세)` 폴백 정규식 추가됨.

---

### 1.2 주소(우편번호) 형식

| 형식 | 예시 | 해당 파일 |
|------|------|-----------|
| 괄호 + **5자리** | (15375), (15502), (59662), (02007) | 대부분 |
| 괄호 + **3-3 하이픈** | (435-760) | **박재혁** |

- **현재 1차 정규식**: `주소\s+\(?\d{5}\)?\s*([^\n]+?)(?=\s+경력\s|$)`
  - 5자리만 허용 → `(435-760)` 은 **1차에서 매칭 안 됨**.
- **대체 정규식**: `주소\s+([^\n]+)` (블록 전체) → `(435-760) 경기 군포시 오금동` 은 **대체에서만 추출**.
- **영향**: 박재혁은 주소는 나오지만, 1차 패턴이 통일되지 않음. 다른 3-3 형식 우편번호가 나오면 1차 실패·대체 의존.

---

### 1.3 상단 표 컬럼/순서

- **경력 먼저**: `경력 / 학력 / 희망연봉 / 포트폴리오` → 강동화, 고재영, 박재혁, 배상훈, …
- **학력 먼저**: `학력 / 경력 / …` → **박건우**, **진정한**, **이현성**
- **컬럼 추가**: `희망 직무·직업`, `희망근무지역` 등 → **김혜림**

- **영향**: `경력\s*총`, `희망연봉`, `직전\s*연봉` 등은 **텍스트 전체 검색**이라 순서가 바뀌어도 매칭 자체는 됨. 다만 같은 블록 안에 “총 N년 N개월”이 여러 번 나오면(요약표 + 본문) **첫 번째만** 잡히거나, 학력 기간이 먼저 나오는 경우 **경력 총**으로 오인할 여지는 있음(현재는 학력 패턴을 경력보다 먼저 보는 로직으로 완화됨).

---

### 1.4 김혜림: 이력서 하단 고정 문구 블록

- **내용**: “이력서 파일”, “파일 미리 보기 …”, “이력서(김혜림).pdf”, “위의 모든 내용은 사실과 다름 없음을 …”, “입사지원일 : … / 작성자 : 김혜림”, 위조 문서 경고 문구 등.
- **위치**: 요약 표 다음, 빈 줄 3개로 구분된 **별도 블록들**.

- **영향**:
  - **입사지원일**: 정규식 `입사지원일\s*:\s*([^)]+\))` 은 **첫 번째** 매칭만 사용 → 상단과 하단에 두 번 나와도 상단 값 사용. 의도한 동작.
  - **작성자**: “작성자 : 김혜림”은 현재 이름 추출 정규식과는 별개라 직접적인 충돌은 없음.
  - **긴 경고 문구**: 블록이 “자기소개서”처럼 긴 문단으로 분류되면 `self_introduction` 등으로 들어갈 수 있음 → **의도하지 않은 selfIntroduction 채움** 가능성.

---

### 1.5 “간략 소개” 유무·위치

- **있는 케이스**: PRASETYO, 김영민, 이찬영, 이현성, 홍인표 등 → “간략 소개” 제목 아래 1~2문단.
- **없는 케이스**: 강동화, 고재영, 박재혁, 배상훈, 송용수, 이영훈, 임은태, 정호현 등 → 표·“나의 스킬”·경력 상세만.

- **영향**: “간략 소개” 블록이 **self_introduction**으로 묶이면 정상. 없으면 해당 필드는 비어 있음. 다만 1.4처럼 김혜림은 “간략 소개” 대신 **경고 문구 블록**이 길게 붙어 있으면, 그 블록이 self_introduction으로 잡힐 수 있음.

---

### 1.6 “나의 스킬” 전/후 블록 경계

- 대부분: 지원분야/입사지원일 → 이름·성별·나이 → 이메일·휴대폰·주소 → (빈 줄 3개) → 요약 표 → (빈 줄 3개) → “나의 스킬”.
- **이영훈**: 요약 표 직후에 “경력 총 3년 11개월”·경력 상세가 나오고, “나의 스킬”이 없거나 뒤쪽에 있음.
- **진정한**: 학력만 있고 경력 “-” → “학력 대학교(2,3년) 졸업예정” 블록이 먼저 나옴.

- **영향**: 블록 구분이 **연속 빈 줄 3개** 기준이라, 빈 줄 개수가 2개인 구간이 있으면 **블록이 합쳐져** “나의 스킬”과 요약 표가 한 블록으로 들어갈 수 있음. 그러면 `_identify_section_name`에서 “경력 총” 등이 같이 있어 **career_summary**로만 분류되고, 스킬 텍스트가 경력 블록에 섞일 수 있음.

---

## 2. 정규식 파싱에서 의도하지 않은 결과를 유도할 수 있는 부분

### 2.1 주소: 5자리 전제

- **위치**: `parse_header_block` 주소 1차 패턴 `주소\s+\(?\d{5}\)?\s*([^\n]+?)(?=\s+경력\s|$)`.
- **문제**: `(435-760)` 같은 **3-3 우편번호**는 1차에서 무시됨.
- **제안**: 1차 패턴에 `(\d{5}|\d{3}-\d{3})` 같은 형식을 추가해, 5자리와 3-3를 모두 허용하면 1차에서 일관되게 추출 가능.

---

### 2.2 김혜림형: 하단 고정 문구가 selfIntroduction으로 들어감

- **위치**: `_identify_section_name` 에서 긴 문단을 `self_introduction`으로 보는 조건.
- **문제**: “위의 모든 내용은 사실과 …”, “위조된 문서를 …” 등 **이력서 하단 경고 문구**가 한 블록으로 묶이면, 길이만으로 self_introduction으로 분류될 수 있음.
- **제안**: 블록 내용에 “파일 미리 보기”, “위조된 문서”, “사람인”, “개인회원약관” 등 **키워드가 있으면** self_introduction 후보에서 제외하거나, “이력서 파일” 블록으로 따로 분류해 selfIntroduction에 넣지 않기.

---

### 2.3 “총 N년 N개월”이 여러 번 나올 때

- **위치**: `경력\s*총\s*(\d+년\s*\d*개월)` 및 `총\s*(\d+년\s*\d*개월)`.
- **문제**: 요약 표의 “총 16년 9개월”과 학력 쪽 “총 2년” 등이 같은 블록에 있으면 **첫 번째만** 잡힘. 학력·경력 블록이 합쳐진 경우, “총 N년”이 경력이 아닌데 totalCareer로 들어갈 여지가 있음(현재는 학력 블록을 먼저 보는 로직으로 일부 완화).
- **제안**: totalCareer는 **경력 블록/요약 표 영역**에서만 추출하도록, 블록의 section이 career_summary 또는 header일 때만 매칭하는 식으로 제한할 수 있음(구현 시 블록 단위 파싱 필요).

---

### 2.4 블록 경계(빈 줄 2개)

- **위치**: `split_into_sections` 의 `MIN_EMPTY_LINES = 3`.
- **문제**: 일부 PDF에서 섹션 사이가 **빈 줄 2개**면, 두 섹션이 **한 블록**으로 합쳐짐. 그러면 “경력 총” + “나의 스킬”이 한 블록에 있어 career_summary로만 분류되거나, 반대로 skills 텍스트가 경력 파서에 넘어갈 수 있음.
- **제안**: 2개 연속 빈 줄도 “약한 경계”로 보고, 블록을 나누진 않되 **섹션 식별** 시 “나의 스킬” 등 키워드가 있으면 그 앞에서 가상 분할하거나, 블록 내부에서 “경력 총” vs “나의 스킬” 구간을 나누어 파싱하는 방식 검토.

---

## 3. 요약 표

| 구분 | 내용 |
|------|------|
| **1단계 출력 차이** | 성별/생년/나이 줄 형식(남, YYYY vs YYYY만), 우편번호(5자리 vs 3-3), 표 컬럼 순서(경력/학력 순서·추가 컬럼), 김혜림의 하단 고정 문구, “간략 소개” 유무, “나의 스킬” 전후 블록 경계 |
| **파싱 리스크** | (1) 주소 1차 정규식이 3-3 우편번호 무시 (2) 하단 경고 문구가 selfIntroduction으로 분류 (3) “총 N년 N개월”이 학력 등 다른 맥락에서 잡힐 수 있음 (4) 빈 줄 2개 구간에서 블록 합쳐짐으로 인한 잘못된 섹션/필드 매핑 |

위 항목을 반영해 정규식과 섹션 분류 로직을 조정하면, 20건 1단계 차이에 따른 의도하지 않은 파싱을 더 줄일 수 있습니다.

---

## 4. 공통 헤더 리스트 방식 (대안)

여러 이력서 pdftotext 출력을 비교해 **공통으로 자주 등장하는 텍스트**를 헤더 후보로 뽑고, 새 이력서에서는 그 리스트와 **일치하는 문자열 = 헤더**, **그 사이 = 내용**으로 구간을 나누는 방식.

### 4.1 사용 방법

1. **헤더 후보 추출** (20건 stage1 출력 기준)
   ```bash
   python3 scripts/build_common_headers.py pdf_resume/debug
   ```
   → `pdf_resume/common_headers.json` 에 `section_headers` 리스트 저장.

2. **공통 헤더로 구간 분할해서 파싱**
   ```bash
   python3 scripts/parse_pdf_resume.py --use-corpus-headers pdf_resume/홍길동_이력서.pdf
   ```

### 4.2 헤더 + 뒤 줄넘김/공백까지 하나의 패턴으로 매칭

- **헤더 문자열만** 쓰면 표 행("경력  학력")과 본문("경력\n\n\n")을 구분하기 어렵다.
- **헤더 + 그 뒤 빈 줄 개수**까지 하나로 두고, 코퍼스에서 "헤더 뒤에 빈 줄이 N개 이상 이어지는 경우"만 섹션 헤더로 인정하면, 표(뒤에 빈 줄 없음)와 본문(뒤에 2~3줄 빈 줄)을 구분할 수 있다.
- `section_headers_with_trailing`: `[{ "text": "경력", "trailing_min_empty_lines": 2 }, ...]` 형태로 저장하고, 파싱 시 **해당 라인 뒤에 빈 줄이 최소 N개**일 때만 헤더로 쓴다. (예: "연봉" 단독은 경력 본문 "연봉 3,800만원"에서 잘리므로 섹션 헤더에서 제외.)

### 4.3 한계

- **같은 헤더가 표와 본문에 둘 다 나오고, 둘 다 뒤에 빈 줄이 2개 이상**인 경우에는 여전히 둘 다 매칭될 수 있음.
- **한 줄에 여러 헤더**: "경력  학력  희망연봉" 같은 표 헤더 줄에서는 **한 줄당 첫 번째로 매칭된 헤더만** 사용하고, 뒤 빈 줄 조건으로 표 행은 제외됨.

### 4.4 정리

- 템플릿이 비슷한 이력서에서 **순서/표현이 조금 달라도** 공통 문자열로 구간을 나눌 수 있음.
- 표와 본문에 같은 단어가 반복되면 구간이 의도와 다르게 끊길 수 있으므로, 기본값은 **연속 빈 줄 기준 분할**이고, `--use-corpus-headers`는 실험/보조용으로 두는 것이 좋음.
